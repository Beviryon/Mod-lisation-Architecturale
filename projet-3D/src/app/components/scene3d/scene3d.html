<div class="scene-container" [class.sidebar-open]="showTestModal">
  <div #canvasContainer class="canvas-container"></div>
  <div class="controls-info">
    <h3>Mod√©lisation</h3>
    
    <div class="controls-section">
      <h4>Contr√¥les</h4>
      <button class="reset-button" (click)="resetCameraPosition()">R√©initialiser</button>
      <button class="legend-button" (click)="openLegendModal()">Voir la l√©gende</button>
      <button class="test-button" (click)="openTestModal()"> Test des Services</button>
      <button class="dimensions-button" (click)="toggleDimensionsInterface()"> Dimensions Temps R√©el</button>
      <button class="fenetres-button" (click)="toggleFenetresInterface()"> Fen√™tres Temps R√©el</button>
      <button class="murs-button" (click)="toggleMursInterface()"> Murs Temps R√©el</button>
      <button class="calculateur-button" (click)="toggleCalculateurFenetres()"> üßÆ Calculateur Fen√™tres</button>
      
      <h4>Contr√¥les Souris</h4>
      <ul>
        <li><strong>Clic + Glisser</strong> : Rotation autour de la construction</li>
        <li><strong>Molette</strong> : Zoom avant/arri√®re (5-50)</li>
        <li><strong>Clic droit</strong> : D√©sactiv√©</li>
      </ul>
    </div>


  <!-- Modale de l√©gende -->
  <div class="modal-overlay" [class.show]="showLegendModal" (click)="closeLegendModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>L√©gende de la Mod√©lisation 3D</h2>
        <button class="close-button" (click)="closeLegendModal()">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="legend-section">
          <h3>Architecture du B√¢timent</h3>
          <div class="building-info">
            <div class="info-card">
              <h4>Dimensions G√©n√©rales</h4>
              <ul>
                <li><strong>Longueur :</strong> 8 m</li>
                <li><strong>Largeur :</strong> 5 m</li>
                <li><strong>Hauteur :</strong> 2.5 m</li>
                <li><strong>√âpaisseur des murs :</strong> 0.20 m</li>
              </ul>
            </div>
            
            <div class="info-card">
              <h4>√âl√©ments Structurels</h4>
              <ul>
                <li><strong>Sol :</strong> Plateforme de base (8m √ó 5m √ó 0.20m)</li>
                <li><strong>Toit :</strong> Couverture (8.4m √ó 5m √ó 0.20m)</li>
                <li><strong>Murs :</strong> 4 murs formant un rectangle</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="legend-section">
          <h3>Ouvertures et Acc√®s</h3>
          <div class="openings-info">
            <div class="opening-card door">
              <div class="opening-icon">üö™</div>
              <div class="opening-details">
                <h4>Porte d'Entr√©e</h4>
                <ul>
                  <li><strong>Position :</strong> Mur principal </li>
                  <li><strong>Dimensions :</strong> 1m √ó 2.1m</li>
                  <li><strong>Couleur :</strong> Vert</li>
                  <li><strong>Epaisseur:</strong> 0.05m</li>
                </ul>
              </div>
            </div>

            <div class="opening-card window">
              <div class="opening-icon">ü™ü</div>
              <div class="opening-details">
                <h4>Fen√™tre 1</h4>
                <ul>
                  <li><strong>Position :</strong> Mur principal (fa√ßade)</li>
                  <li><strong>Dimensions :</strong> 1.5m √ó 1.2m</li>
                  <li><strong>Couleur :</strong> Rouge</li>
                  <li><strong>Epaisseur:</strong> 0.05m</li>
                </ul>
              </div>
            </div>

            <div class="opening-card window">
              <div class="opening-icon">ü™ü</div>
              <div class="opening-details">
                <h4>Fen√™tre 2</h4>
                <ul>
                  <li><strong>Position :</strong> Mur principal (fa√ßade)</li>
                  <li><strong>Dimensions :</strong> 2m √ó 1.2m</li>
                  <li><strong>Couleur :</strong> Rouge</li>
                  <li><strong>Epaisseur:</strong> 0.05m</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="legend-section">
          <h3>Code Couleurs</h3>
          <div class="color-legend">
            <div class="color-item">
              <div class="color-box color-walls"></div>
              <span><strong>Murs :</strong> Gris clair (#aaaaaa)</span>
            </div>
            <div class="color-item">
              <div class="color-box color-door"></div>
              <span><strong>Porte :</strong> Vert (#00ff00)</span>
            </div>
            <div class="color-item">
              <div class="color-box color-windows"></div>
              <span><strong>Fen√™tres :</strong> Rouge (#ff0000)</span>
            </div>
            <div class="color-item">
              <div class="color-box color-ground"></div>
              <span><strong>Sol :</strong> Marron fonc√© (#2E1E1A)</span>
            </div>
            <div class="color-item">
              <div class="color-box color-roof"></div>
              <span><strong>Toit :</strong> Bleu royal (#4169e1)</span>
            </div>
          </div>
        </div>

        <div class="legend-section">
          <h3> Contr√¥les de Navigation</h3>
          <div class="controls-legend">
            <div class="control-item">
              <div class="control-icon">üñ±Ô∏è</div>
              <div class="control-text">
                <strong>Clic + Glisser :</strong> Rotation autour du b√¢timent
              </div>
            </div>
            <div class="control-item">
              <div class="control-icon">üéØ</div>
              <div class="control-text">
                <strong>Molette :</strong> Zoom avant/arri√®re (5-50 unit√©s)
              </div>
            </div>
            <div class="control-item">
              <div class="control-icon">üîÑ</div>
              <div class="control-text">
                <strong>Bouton R√©initialiser :</strong> Retour √† la vue initiale
              </div>
            </div>
          </div>
        </div>

        <div class="legend-section">
          <h3>üìê Syst√®me de Coordonn√©es</h3>
          <div class="coordinates-info">
            <div class="axis-info">
              <div class="axis-color axis-x"></div>
              <span><strong>Axe X (Rouge) :</strong> Gauche/Droite</span>
            </div>
            <div class="axis-info">
              <div class="axis-color axis-y"></div>
              <span><strong>Axe Y (Vert) :</strong> Bas/Haut</span>
            </div>
            <div class="axis-info">
              <div class="axis-color axis-z"></div>
              <span><strong>Axe Z (Bleu) :</strong> Avant/Arri√®re</span>
            </div>
          </div>
        </div>

        <div class="legend-section">
          <h3>üí° Techniques Utilis√©es</h3>
          <div class="tech-info">
            <div class="tech-card">
              <h4>Three.js</h4>
              <p>Biblioth√®que JavaScript pour la cr√©ation de graphiques 3D dans le navigateur</p>
            </div>
            <div class="tech-card">
              <h4>ExtrudeGeometry</h4>
              <p>Technique utilis√©e pour cr√©er de vraies ouvertures dans les murs (trous)</p>
            </div>
            <div class="tech-card">
              <h4>Configuration Centralis√©e</h4>
              <p>Toutes les dimensions et couleurs sont d√©finies dans un fichier de configuration (building-config.ts)</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="close-modal-btn" (click)="closeLegendModal()">Fermer</button>
      </div>
    </div>
  </div>
</div>


<!-- Sidebar de test des services -->
<div class="sidebar-overlay" [class.show]="showTestModal" (click)="closeTestModal($event)">
  <div class="sidebar-content test-sidebar" (click)="$event.stopPropagation()">
    <div class="sidebar-header">
      <h2> Test des Services</h2>
      <button class="sidebar-close" (click)="closeTestModal($event)">√ó</button>
    </div>
    <div class="sidebar-body">
      <!-- Section des tests de base -->
      <div class="test-section">
        <h3>Tests de Base</h3>
        <div class="test-buttons">
          <button (click)="testStatistiques()" class="btn-test btn-blue">
            <div class="btn-icon"></div>
            <div class="btn-label">Statistiques</div>
          </button>
          <button (click)="testExport()" class="btn-test btn-purple">
            <div class="btn-icon"></div>
            <div class="btn-label">Export</div>
          </button>
          <button (click)="testValidation()" class="btn-test btn-red">
            <div class="btn-icon"></div>
            <div class="btn-label">Synchroniser</div>
          </button>
        </div>
      </div>

      <!-- Section des tests de couleurs automatiques -->
      <div class="test-section">
        <h3> Tests de Couleurs Automatiques</h3>
        <!-- <div class="test-buttons">
          <button (click)="testCouleurs()" class="btn-test btn-orange">
            <div class="btn-icon"></div>
            <div class="btn-label">Couleurs Murs</div>
          </button>
          <button (click)="testCouleursOuvertures()" class="btn-test btn-cyan">
            <div class="btn-icon"></div>
            <div class="btn-label">Couleurs Ouvertures</div>
          </button>
        </div> -->
      </div>

      <!-- Section du s√©lecteur de couleurs interactif -->
      <div class="test-section">
        <h3> S√©lecteur de Couleurs Interactif</h3>
        
        <!-- S√©lecteur de couleurs -->
        <div class="color-picker-section">
          <div class="color-picker-container">
            <label for="colorPicker">Choisir une couleur :</label>
            <div class="color-input-group">
              <input type="color" id="colorPicker" [(ngModel)]="selectedColor" (change)="onColorChange()" class="color-picker">
              <span class="color-value">{{selectedColor}}</span>
            </div>
          </div>
        </div>

        <!-- S√©lection des √©l√©ments -->
        <div class="element-selection-section">
          <div class="element-group">
            <h4> Murs</h4>
            <div class="element-buttons">
              <button (click)="changeElementColor('principal')" class="btn-element" [class.active]="selectedElement === 'principal'">
                <div class="element-icon"></div>
                <div class="element-label">Mur Principal</div>
              </button>
              <button (click)="changeElementColor('arriere')" class="btn-element" [class.active]="selectedElement === 'arriere'">
                <div class="element-icon"></div>
                <div class="element-label">Mur Arri√®re</div>
              </button>
              <button (click)="changeElementColor('gauche')" class="btn-element" [class.active]="selectedElement === 'gauche'">
                <div class="element-icon"></div>
                <div class="element-label">Mur Gauche</div>
              </button>
              <button (click)="changeElementColor('droit')" class="btn-element" [class.active]="selectedElement === 'droit'">
                <div class="element-icon"></div>
                <div class="element-label">Mur Droit</div>
              </button>
            </div>
          </div>

          <div class="element-group">
            <h4> Ouvertures</h4>
            <div class="element-buttons">
              <button (click)="changeElementColor('fenetre2')" class="btn-element" [class.active]="selectedElement === 'fenetre2'">
                <div class="element-icon"></div>
                <div class="element-label">Fen√™tre Principale</div>
    </button>
              <button (click)="changeElementColor('fenetre3')" class="btn-element" [class.active]="selectedElement === 'fenetre3'">
                <div class="element-icon"></div>
                <div class="element-label">Fen√™tre Arri√®re</div>
    </button>
              <button (click)="changeElementColor('porte1')" class="btn-element" [class.active]="selectedElement === 'porte1'">
                <div class="element-icon"></div>
                <div class="element-label">Porte d'Entr√©e</div>
    </button>
            </div>
          </div>
  </div>
  
        <!-- Actions -->
        <div class="color-actions-section">
          <button (click)="resetAllColors()" class="btn-reset">
            <div class="btn-icon"></div>
            <div class="btn-text">Remettre les couleurs originales</div>
    </button>
        </div>
      </div>

      <!-- Section de communication -->
      <!-- <div class="test-section">
        <h3>üì° Communication</h3>
        <!-- Bouton de rechargement de configuration -->
        <div class="reload-section">
          <button (click)="rechargerConfigurationDepuisFichier()" class="btn-reload">
            üîÑ Recharger Configuration
          </button>
          <p class="reload-description">
            Modifiez building-config.ts puis cliquez pour voir les changements
          </p>
        </div>

        <div class="test-buttons">
          <button (click)="testCommunication()" class="btn-test btn-gray">
            <div class="btn-icon">üì°</div>
            <div class="btn-label">Communication</div>
          </button>
          <button (click)="testMateriaux()" class="btn-test btn-purple">
            <div class="btn-icon">üé®</div>
            <div class="btn-label">Mat√©riaux</div>
          </button>
          <button (click)="testScene()" class="btn-test btn-indigo">
            <div class="btn-icon">üé¨</div>
            <div class="btn-label">Sc√®ne 3D</div>
          </button>
          <button (click)="testMurs()" class="btn-test btn-brown">
            <div class="btn-icon">üß±</div>
            <div class="btn-label">Murs</div>
          </button>
          <button (click)="testModificationsMurs()" class="btn-test btn-orange">
            <div class="btn-icon">üîß</div>
            <div class="btn-label">Modifications</div>
          </button>
          <button (click)="testMiseAJourRendu()" class="btn-test btn-teal">
            <div class="btn-icon">üîÑ</div>
            <div class="btn-label">Test Rendu</div>
          </button>
          <button (click)="testModificationOuverture()" class="btn-test btn-pink">
            <div class="btn-icon">üîß</div>
            <div class="btn-label">Test Modif</div>
          </button>
          <button (click)="testModificationComplete()" class="btn-test btn-indigo">
            <div class="btn-icon">üèóÔ∏è</div>
            <div class="btn-label">Test Complet</div>
          </button>
        </div>
  </div> -->
  

      <!-- Modificateur de murs interactif -->
      <div class="mur-modifier-section">
        <h3>üîß Modificateur de Murs Interactif</h3>
        
        <div class="mur-selector">
          <h4>Choisissez un mur √† modifier :</h4>
          <div class="mur-buttons">
            <button 
              class="btn-mur" 
              [class.active]="selectedMur === 'principal'"
              (click)="selectMur('principal')"
            >
              üß± Mur Principal
            </button>
            <button 
              class="btn-mur" 
              [class.active]="selectedMur === 'arriere'"
              (click)="selectMur('arriere')"
            >
              üß± Mur Arri√®re
            </button>
            <button 
              class="btn-mur" 
              [class.active]="selectedMur === 'gauche'"
              (click)="selectMur('gauche')"
            >
              üß± Mur Gauche
            </button>
            <button 
              class="btn-mur" 
              [class.active]="selectedMur === 'droit'"
              (click)="selectMur('droit')"
            >
              üß± Mur Droit
            </button>
          </div>
        </div>

        <div class="mur-properties" *ngIf="selectedMur">
          <h4>Propri√©t√©s du {{ selectedMur === 'principal' ? 'Mur Principal' : selectedMur === 'arriere' ? 'Mur Arri√®re' : selectedMur === 'gauche' ? 'Mur Gauche' : 'Mur Droit' }} :</h4>
          
          <!-- Position -->
          <div class="property-group">
            <h5>üìç Position (X, Y, Z) :</h5>
            <div class="input-group">
              <input 
                type="number" 
                [(ngModel)]="murPosition.x" 
                step="0.1" 
                placeholder="X"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="murPosition.y" 
                step="0.1" 
                placeholder="Y"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="murPosition.z" 
                step="0.1" 
                placeholder="Z"
                class="number-input"
              >
              <button (click)="modifierPositionMur()" class="btn-apply">
                ‚úÖ Appliquer Position
              </button>
            </div>
          </div>

          <!-- Dimensions -->
          <div class="property-group">
            <h5>üìê Dimensions (Largeur, Hauteur, Profondeur) :</h5>
            <div class="input-group">
              <input 
                type="number" 
                [(ngModel)]="murDimensions.width" 
                step="0.1" 
                placeholder="Largeur"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="murDimensions.height" 
                step="0.1" 
                placeholder="Hauteur"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="murDimensions.depth" 
                step="0.1" 
                placeholder="Profondeur"
                class="number-input"
              >
              <button (click)="modifierDimensionsMur()" class="btn-apply">
                ‚úÖ Appliquer Dimensions
              </button>
            </div>
          </div>

          <!-- √âpaisseur -->
          <div class="property-group">
            <h5>üìè √âpaisseur :</h5>
            <div class="input-group">
              <input 
                type="number" 
                [(ngModel)]="murEpaisseur" 
                step="0.01" 
                placeholder="√âpaisseur"
                class="number-input"
              >
              <button (click)="modifierEpaisseurMur()" class="btn-apply">
                ‚úÖ Appliquer √âpaisseur
              </button>
            </div>
          </div>

          <!-- Couleur -->
          <div class="property-group">
            <h5>üé® Couleur :</h5>
            <div class="input-group">
              <label for="murColorPicker" class="sr-only">S√©lecteur de couleur du mur</label>
              <input 
                type="color" 
                id="murColorPicker"
                [(ngModel)]="murCouleur"
                class="color-input"
                title="S√©lecteur de couleur du mur"
              >
              <span class="color-display">{{ murCouleur }}</span>
              <button (click)="modifierCouleurMurInteractive()" class="btn-apply">
                ‚úÖ Appliquer Couleur
              </button>
            </div>
          </div>

          <!-- Actions globales -->
          <div class="mur-actions">
            <button (click)="appliquerModificationsMur()" class="btn-apply-all">
              üöÄ Appliquer Toutes les Modifications
            </button>
            <button (click)="resetMurValues()" class="btn-reset">
              üîÑ R√©initialiser
            </button>
          </div>
        </div>
      </div>

      <!-- Zone de sortie des tests -->
      <div class="test-output-section">
        <h3>üìä R√©sultats des Tests</h3>
        <div id="services-output" class="test-output">
          <div class="success-message">‚úÖ Services int√©gr√©s avec succ√®s!</div>
    <div>Cliquez sur les boutons pour tester les fonctionnalit√©s.</div>
        </div>
      </div>

      <!-- ===== NOUVELLES SECTIONS D'INTERFACE COMPL√àTE ===== -->

      <!-- Section Modificateur d'Ouvertures -->
      <div class="test-section">
        <h3>üö™ Modificateur d'Ouvertures</h3>
        
        <div class="ouverture-selector">
          <h4>Choisissez une ouverture √† modifier :</h4>
          <div class="ouverture-buttons">
            <button 
              class="btn-ouverture" 
              [class.active]="selectedOuverture === 'fenetre1'"
              (click)="selectOuverture('fenetre1')"
            >
              ü™ü Fen√™tre 1
            </button>
            <button 
              class="btn-ouverture" 
              [class.active]="selectedOuverture === 'fenetre2'"
              (click)="selectOuverture('fenetre2')"
            >
              ü™ü Fen√™tre 2
            </button>
            <button 
              class="btn-ouverture" 
              [class.active]="selectedOuverture === 'porte1'"
              (click)="selectOuverture('porte1')"
            >
              üö™ Porte 1
            </button>
          </div>
        </div>

        <div class="ouverture-properties" *ngIf="selectedOuverture">
          <h4>Propri√©t√©s de l'ouverture :</h4>
          
          <!-- Type et Nom -->
          <div class="property-group">
            <h5>üìù Type et Nom :</h5>
            <div class="input-group">
              <select [(ngModel)]="ouvertureType" class="select-input" title="Type d'ouverture" aria-label="Type d'ouverture">
                <option value="fenetre">Fen√™tre</option>
                <option value="porte">Porte</option>
              </select>
              <input 
                type="text" 
                [(ngModel)]="ouvertureNom" 
                placeholder="Nom de l'ouverture"
                class="text-input"
              >
            </div>
          </div>

          <!-- Position -->
          <div class="property-group">
            <h5>üìç Position (X, Y, Z) :</h5>
            <div class="input-group">
              <input 
                type="number" 
                [(ngModel)]="ouverturePosition.x" 
                step="0.1" 
                placeholder="X"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="ouverturePosition.y" 
                step="0.1" 
                placeholder="Y"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="ouverturePosition.z" 
                step="0.1" 
                placeholder="Z"
                class="number-input"
              >
              <button (click)="modifierPositionOuverture()" class="btn-apply">
                ‚úÖ Appliquer Position
              </button>
            </div>
          </div>

          <!-- Dimensions -->
          <div class="property-group">
            <h5>üìê Dimensions (Largeur, Hauteur, Profondeur) :</h5>
            <div class="input-group">
              <input 
                type="number" 
                [(ngModel)]="ouvertureDimensions.width" 
                step="0.1" 
                placeholder="Largeur"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="ouvertureDimensions.height" 
                step="0.1" 
                placeholder="Hauteur"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="ouvertureDimensions.depth" 
                step="0.01" 
                placeholder="Profondeur"
                class="number-input"
              >
              <button (click)="modifierDimensionsOuverture()" class="btn-apply">
                ‚úÖ Appliquer Dimensions
              </button>
            </div>
          </div>

          <!-- Couleur -->
          <div class="property-group">
            <h5>üé® Couleur :</h5>
            <div class="input-group">
              <input 
                type="color" 
                [(ngModel)]="ouvertureCouleur"
                class="color-input"
                title="Couleur de l'ouverture"
                aria-label="Couleur de l'ouverture"
              >
              <span class="color-display">{{ ouvertureCouleur }}</span>
              <button (click)="modifierCouleurOuvertureInteractive()" class="btn-apply">
                ‚úÖ Appliquer Couleur
              </button>
            </div>
          </div>

          <!-- Actions -->
          <div class="ouverture-actions">
            <button (click)="ajouterOuverture()" class="btn-add">
              ‚ûï Ajouter Ouverture
            </button>
            <button (click)="supprimerOuverture()" class="btn-delete">
              üóëÔ∏è Supprimer
            </button>
            <button (click)="resetOuvertureValues()" class="btn-reset">
              üîÑ R√©initialiser
            </button>
          </div>
        </div>
      </div>

      <!-- Section Modificateur de Structure -->
      <div class="test-section">
        <h3>üèóÔ∏è Modificateur de Structure</h3>
        
        <div class="structure-properties">
          <!-- Nom et Description -->
          <div class="property-group">
            <h5>üìù Informations G√©n√©rales :</h5>
            <div class="input-group">
              <input 
                type="text" 
                [(ngModel)]="structureNom" 
                placeholder="Nom du b√¢timent"
                class="text-input"
              >
              <textarea 
                [(ngModel)]="structureDescription" 
                placeholder="Description du b√¢timent"
                class="textarea-input"
                rows="2"
              ></textarea>
            </div>
          </div>

          <!-- Dimensions Globales -->
          <div class="property-group">
            <h5>Dimensions Globales (m) :</h5>
            <div class="input-group">
              <input 
                type="number" 
                [(ngModel)]="structureDimensions.longueur" 
                step="0.1" 
                placeholder="Longueur"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="structureDimensions.largeur" 
                step="0.1" 
                placeholder="Largeur"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="structureDimensions.hauteur" 
                step="0.1" 
                placeholder="Hauteur"
                class="number-input"
              >
              <button (click)="modifierStructureDimensions()" class="btn-apply">
                Appliquer Dimensions
              </button>
            </div>
          </div>

          <!-- Actions -->
          <div class="structure-actions">
            <button (click)="resetStructureValues()" class="btn-reset">
              R√©initialiser Structure
            </button>
          </div>
        </div>
      </div>


      <!-- Section Validation en Temps R√©el -->
      <div class="test-section">
        <h3>Validation en Temps R√©el</h3>
        
        <div class="validation-panel">
          <!-- Score de Validation -->
          <div class="validation-score">
            <h5>Score de Validation :</h5>
            <div class="score-display" [class]="'score-' + (scoreValidation >= 80 ? 'good' : scoreValidation >= 60 ? 'warning' : 'error')">
              {{ scoreValidation }}/100
            </div>
          </div>

          <!-- Erreurs -->
          <div class="validation-errors" *ngIf="erreursValidation.length > 0">
            <h5>‚ùå Erreurs :</h5>
            <ul>
              <li *ngFor="let erreur of erreursValidation">{{ erreur }}</li>
            </ul>
          </div>

          <!-- Avertissements -->
          <div class="validation-warnings" *ngIf="avertissementsValidation.length > 0">
            <h5>‚ö†Ô∏è Avertissements :</h5>
            <ul>
              <li *ngFor="let avertissement of avertissementsValidation">{{ avertissement }}</li>
            </ul>
          </div>

          <!-- Actions -->
          <div class="validation-actions">
            <button (click)="validerConfiguration()" class="btn-validate">
              Valider Configuration
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Interface de Dimensions en Temps R√©el -->
<div class="dimensions-overlay" [class.show]="showDimensionsInterface" (click)="toggleDimensionsInterface()">
  <div class="dimensions-content" (click)="$event.stopPropagation()">
    <div class="dimensions-header">
      <h2>üìè Dimensions en Temps R√©el</h2>
      <button class="dimensions-close" (click)="toggleDimensionsInterface()">√ó</button>
    </div>
    
    <div class="dimensions-body">
      <!-- Contr√¥les de mise √† jour -->
      <div class="realtime-controls">
        <div class="control-group">
          <label class="control-label">
            <input type="checkbox" [(ngModel)]="isRealTimeUpdate" (change)="toggleRealTimeUpdate()">
            ‚ö° Mise √† jour en temps r√©el
          </label>
        </div>
        
        <div class="control-actions" *ngIf="!isRealTimeUpdate">
          <button (click)="appliquerDimensionsManuellement()" class="btn-apply">
            ‚úÖ Appliquer les Dimensions
          </button>
        </div>
      </div>

      <!-- Contr√¥les des dimensions -->
      <div class="dimensions-controls">
        <h3>üèóÔ∏è Dimensions du B√¢timent</h3>
        
        <!-- Longueur -->
        <div class="dimension-group">
          <label class="dimension-label">
            üìê Longueur (m)
          </label>
          <div class="dimension-control">
            <input 
              type="range" 
              min="2" 
              max="20" 
              step="0.1" 
              [(ngModel)]="dimensionsReelTemps.longueur"
              (input)="onDimensionsChange()"
              class="dimension-slider"
              title="Longueur du b√¢timent"
              aria-label="Longueur du b√¢timent"
            >
            <input 
              type="number" 
              min="2" 
              max="20" 
              step="0.1" 
              [(ngModel)]="dimensionsReelTemps.longueur"
              (input)="onDimensionsChange()"
              class="dimension-input"
              title="Longueur du b√¢timent"
              aria-label="Longueur du b√¢timent"
              placeholder="Longueur"
            >
            <span class="dimension-value">{{ dimensionsReelTemps.longueur }}m</span>
          </div>
        </div>

        <!-- Largeur -->
        <div class="dimension-group">
          <label class="dimension-label">
            üìè Largeur (m)
          </label>
          <div class="dimension-control">
            <input 
              type="range" 
              min="2" 
              max="15" 
              step="0.1" 
              [(ngModel)]="dimensionsReelTemps.largeur"
              (input)="onDimensionsChange()"
              class="dimension-slider"
              title="Largeur du b√¢timent"
              aria-label="Largeur du b√¢timent"
            >
            <input 
              type="number" 
              min="2" 
              max="15" 
              step="0.1" 
              [(ngModel)]="dimensionsReelTemps.largeur"
              (input)="onDimensionsChange()"
              class="dimension-input"
              title="Largeur du b√¢timent"
              aria-label="Largeur du b√¢timent"
              placeholder="Largeur"
            >
            <span class="dimension-value">{{ dimensionsReelTemps.largeur }}m</span>
          </div>
        </div>

        <!-- Hauteur -->
        <div class="dimension-group">
          <label class="dimension-label">
            üìè Hauteur (m)
          </label>
          <div class="dimension-control">
            <input 
              type="range" 
              min="1" 
              max="10" 
              step="0.1" 
              [(ngModel)]="dimensionsReelTemps.hauteur"
              (input)="onDimensionsChange()"
              class="dimension-slider"
              title="Hauteur du b√¢timent"
              aria-label="Hauteur du b√¢timent"
            >
            <input 
              type="number" 
              min="1" 
              max="10" 
              step="0.1" 
              [(ngModel)]="dimensionsReelTemps.hauteur"
              (input)="onDimensionsChange()"
              class="dimension-input"
              title="Hauteur du b√¢timent"
              aria-label="Hauteur du b√¢timent"
              placeholder="Hauteur"
            >
            <span class="dimension-value">{{ dimensionsReelTemps.hauteur }}m</span>
          </div>
        </div>
      </div>

      <!-- Informations actuelles -->
      <div class="dimensions-info">
        <h3>üìä Informations Actuelles</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Surface au sol :</span>
            <span class="info-value">{{ (dimensionsReelTemps.longueur * dimensionsReelTemps.largeur).toFixed(1) }} m¬≤</span>
          </div>
          <div class="info-item">
            <span class="info-label">Volume :</span>
            <span class="info-value">{{ (dimensionsReelTemps.longueur * dimensionsReelTemps.largeur * dimensionsReelTemps.hauteur).toFixed(1) }} m¬≥</span>
          </div>
          <div class="info-item">
            <span class="info-label">P√©rim√®tre :</span>
            <span class="info-value">{{ (2 * (dimensionsReelTemps.longueur + dimensionsReelTemps.largeur)).toFixed(1) }} m</span>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="dimensions-actions">
        <button (click)="chargerDimensionsActuelles()" class="btn-load">
          üì• Charger Dimensions Actuelles
        </button>
        <button (click)="resetDimensionsReelTemps()" class="btn-reset">
          üîÑ R√©initialiser
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Interface des Fen√™tres en Temps R√©el -->
<div class="fenetres-overlay" [class.show]="showFenetresInterface" (click)="toggleFenetresInterface()">
  <div class="fenetres-content" (click)="$event.stopPropagation()">
    <div class="fenetres-header">
      <h2>ü™ü Fen√™tres en Temps R√©el</h2>
      <button class="fenetres-close" (click)="toggleFenetresInterface()">√ó</button>
    </div>
    
    <div class="fenetres-body">
      <!-- Contr√¥les de mise √† jour -->
      <div class="realtime-controls">
        <div class="control-group">
          <label class="control-label">
            <input type="checkbox" [(ngModel)]="isRealTimeUpdate" (change)="toggleRealTimeUpdate()">
            ‚ö° Mise √† jour en temps r√©el
          </label>
        </div>
        
        <div class="control-actions" *ngIf="!isRealTimeUpdate">
          <button (click)="mettreAJourFenetresReelTemps()" class="btn-apply">
            ‚úÖ Appliquer les Modifications
          </button>
        </div>
      </div>

      <!-- Contr√¥les des fen√™tres -->
      <div class="fenetres-controls">
        <h3>ü™ü Propri√©t√©s des Fen√™tres</h3>
        
        <!-- Dimensions -->
        <div class="dimension-group">
          <label class="dimension-label">
            üìê Largeur (m)
          </label>
          <div class="dimension-control">
            <input 
              type="range" 
              min="0.5" 
              max="3" 
              step="0.1" 
              [(ngModel)]="fenetresReelTemps.longueur"
              (input)="onFenetresChange()"
              class="dimension-slider"
              title="Largeur de la fen√™tre"
              aria-label="Largeur de la fen√™tre"
            >
            <input 
              type="number" 
              min="0.5" 
              max="3" 
              step="0.1" 
              [(ngModel)]="fenetresReelTemps.longueur"
              (input)="onFenetresChange()"
              class="dimension-input"
              title="Largeur de la fen√™tre"
              aria-label="Largeur de la fen√™tre"
              placeholder="Largeur"
            >
            <span class="dimension-value">{{ fenetresReelTemps.longueur }}m</span>
          </div>
        </div>

        <div class="dimension-group">
          <label class="dimension-label">
            üìè Profondeur (m)
          </label>
          <div class="dimension-control">
            <input 
              type="range" 
              min="0.05" 
              max="0.5" 
              step="0.01" 
              [(ngModel)]="fenetresReelTemps.largeur"
              (input)="onFenetresChange()"
              class="dimension-slider"
              title="Profondeur de la fen√™tre"
              aria-label="Profondeur de la fen√™tre"
            >
            <input 
              type="number" 
              min="0.05" 
              max="0.5" 
              step="0.01" 
              [(ngModel)]="fenetresReelTemps.largeur"
              (input)="onFenetresChange()"
              class="dimension-input"
              title="Profondeur de la fen√™tre"
              aria-label="Profondeur de la fen√™tre"
              placeholder="Profondeur"
            >
            <span class="dimension-value">{{ fenetresReelTemps.largeur }}m</span>
          </div>
        </div>

        <div class="dimension-group">
          <label class="dimension-label">
            üìè Hauteur (m)
          </label>
          <div class="dimension-control">
            <input 
              type="range" 
              min="0.5" 
              max="3" 
              step="0.1" 
              [(ngModel)]="fenetresReelTemps.hauteur"
              (input)="onFenetresChange()"
              class="dimension-slider"
              title="Hauteur de la fen√™tre"
              aria-label="Hauteur de la fen√™tre"
            >
            <input 
              type="number" 
              min="0.5" 
              max="3" 
              step="0.1" 
              [(ngModel)]="fenetresReelTemps.hauteur"
              (input)="onFenetresChange()"
              class="dimension-input"
              title="Hauteur de la fen√™tre"
              aria-label="Hauteur de la fen√™tre"
              placeholder="Hauteur"
            >
            <span class="dimension-value">{{ fenetresReelTemps.hauteur }}m</span>
          </div>
        </div>

        <!-- Couleur -->
        <div class="dimension-group">
          <label class="dimension-label">
            üé® Couleur
          </label>
          <div class="dimension-control">
            <input 
              type="color" 
              [(ngModel)]="fenetresReelTemps.couleur"
              (input)="onFenetresChange()"
              class="color-input"
              title="Couleur de la fen√™tre"
              aria-label="Couleur de la fen√™tre"
            >
            <span class="dimension-value">{{ fenetresReelTemps.couleur }}</span>
          </div>
        </div>

        <!-- Type et Nom -->
        <div class="dimension-group">
          <label class="dimension-label">
            üìù Type et Nom
          </label>
          <div class="dimension-control">
            <select [(ngModel)]="fenetresReelTemps.type" (change)="onFenetresChange()" class="select-input" title="Type de fen√™tre" aria-label="Type de fen√™tre">
              <option value="fenetre">Fen√™tre</option>
              <option value="porte">Porte</option>
            </select>
            <input 
              type="text" 
              [(ngModel)]="fenetresReelTemps.nom"
              (input)="onFenetresChange()"
              placeholder="Nom de la fen√™tre"
              class="text-input"
              title="Nom de la fen√™tre"
              aria-label="Nom de la fen√™tre"
            >
          </div>
        </div>
      </div>

      <!-- Informations actuelles -->
      <div class="fenetres-info">
        <h3>üìä Informations Actuelles</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Surface :</span>
            <span class="info-value">{{ (fenetresReelTemps.longueur * fenetresReelTemps.hauteur).toFixed(2) }} m¬≤</span>
          </div>
          <div class="info-item">
            <span class="info-label">Volume :</span>
            <span class="info-value">{{ (fenetresReelTemps.longueur * fenetresReelTemps.largeur * fenetresReelTemps.hauteur).toFixed(3) }} m¬≥</span>
          </div>
          <div class="info-item">
            <span class="info-label">P√©rim√®tre :</span>
            <span class="info-value">{{ (2 * (fenetresReelTemps.longueur + fenetresReelTemps.hauteur)).toFixed(2) }} m</span>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="fenetres-actions">
        <button (click)="chargerFenetresActuelles()" class="btn-load">
          üì• Charger Propri√©t√©s Actuelles
        </button>
        <button (click)="resetFenetresReelTemps()" class="btn-reset">
          üîÑ R√©initialiser
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Interface des Murs en Temps R√©el -->
<div class="murs-overlay" [class.show]="showMursInterface" (click)="toggleMursInterface()">
  <div class="murs-content" (click)="$event.stopPropagation()">
    <div class="murs-header">
      <h2>üß± Murs en Temps R√©el</h2>
      <button class="murs-close" (click)="toggleMursInterface()">√ó</button>
    </div>
    
    <div class="murs-body">
      <!-- Contr√¥les de mise √† jour -->
      <div class="realtime-controls">
        <div class="control-group">
          <label class="control-label">
            <input type="checkbox" [(ngModel)]="isRealTimeUpdate" (change)="toggleRealTimeUpdate()">
            ‚ö° Mise √† jour en temps r√©el
          </label>
        </div>
        
        <div class="control-actions" *ngIf="!isRealTimeUpdate">
          <button (click)="mettreAJourMursReelTemps()" class="btn-apply">
            ‚úÖ Appliquer les Modifications
          </button>
        </div>
      </div>

      <!-- Contr√¥les des murs -->
      <div class="murs-controls">
        <h3>üß± Propri√©t√©s des Murs</h3>
        
        <!-- Dimensions -->
        <div class="dimension-group">
          <label class="dimension-label">
            üìê Longueur Murs Principal/Arri√®re (m)
          </label>
          <div class="dimension-control">
            <input 
              type="range" 
              min="2" 
              max="20" 
              step="0.1" 
              [(ngModel)]="mursReelTemps.longueur"
              (input)="onMursChange()"
              class="dimension-slider"
              title="Longueur du mur"
              aria-label="Longueur du mur"
            >
            <input 
              type="number" 
              min="2" 
              max="20" 
              step="0.1" 
              [(ngModel)]="mursReelTemps.longueur"
              (input)="onMursChange()"
              class="dimension-input"
              title="Longueur du mur"
              aria-label="Longueur du mur"
              placeholder="Longueur"
            >
            <span class="dimension-value">{{ mursReelTemps.longueur }}m</span>
          </div>
        </div>

        <div class="dimension-group">
          <label class="dimension-label">
            üìè Largeur Murs Lat√©raux (m)
          </label>
          <div class="dimension-control">
            <input 
              type="range" 
              min="2" 
              max="15" 
              step="0.1" 
              [(ngModel)]="mursReelTemps.largeur"
              (input)="onMursChange()"
              class="dimension-slider"
              title="Largeur des murs lat√©raux"
              aria-label="Largeur des murs lat√©raux"
            >
            <input 
              type="number" 
              min="2" 
              max="15" 
              step="0.1" 
              [(ngModel)]="mursReelTemps.largeur"
              (input)="onMursChange()"
              class="dimension-input"
              title="Largeur des murs lat√©raux"
              aria-label="Largeur des murs lat√©raux"
              placeholder="Largeur"
            >
            <span class="dimension-value">{{ mursReelTemps.largeur }}m</span>
          </div>
        </div>

        <div class="dimension-group">
          <label class="dimension-label">
            üìè Hauteur (m)
          </label>
          <div class="dimension-control">
            <input 
              type="range" 
              min="1" 
              max="10" 
              step="0.1" 
              [(ngModel)]="mursReelTemps.hauteur"
              (input)="onMursChange()"
              class="dimension-slider"
              title="Hauteur du mur"
              aria-label="Hauteur du mur"
            >
            <input 
              type="number" 
              min="1" 
              max="10" 
              step="0.1" 
              [(ngModel)]="mursReelTemps.hauteur"
              (input)="onMursChange()"
              class="dimension-input"
              title="Hauteur du mur"
              aria-label="Hauteur du mur"
              placeholder="Hauteur"
            >
            <span class="dimension-value">{{ mursReelTemps.hauteur }}m</span>
          </div>
        </div>

        <div class="dimension-group">
          <label class="dimension-label">
            üìè √âpaisseur (m)
          </label>
          <div class="dimension-control">
            <input 
              type="range" 
              min="0.1" 
              max="1" 
              step="0.01" 
              [(ngModel)]="mursReelTemps.epaisseur"
              (input)="onMursChange()"
              class="dimension-slider"
              title="√âpaisseur du mur"
              aria-label="√âpaisseur du mur"
            >
            <input 
              type="number" 
              min="0.1" 
              max="1" 
              step="0.01" 
              [(ngModel)]="mursReelTemps.epaisseur"
              (input)="onMursChange()"
              class="dimension-input"
              title="√âpaisseur du mur"
              aria-label="√âpaisseur du mur"
              placeholder="√âpaisseur"
            >
            <span class="dimension-value">{{ mursReelTemps.epaisseur }}m</span>
          </div>
        </div>

        <!-- Couleur -->
        <div class="dimension-group">
          <label class="dimension-label">
            üé® Couleur
          </label>
          <div class="dimension-control">
            <input 
              type="color" 
              [(ngModel)]="mursReelTemps.couleur"
              (input)="onMursChange()"
              class="color-input"
              title="Couleur du mur"
              aria-label="Couleur du mur"
            >
            <span class="dimension-value">{{ mursReelTemps.couleur }}</span>
          </div>
        </div>
      </div>

      <!-- Informations actuelles -->
      <div class="murs-info">
        <h3>üìä Informations Actuelles</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Surface :</span>
            <span class="info-value">{{ (mursReelTemps.longueur * mursReelTemps.hauteur).toFixed(1) }} m¬≤</span>
          </div>
          <div class="info-item">
            <span class="info-label">Volume :</span>
            <span class="info-value">{{ (mursReelTemps.longueur * mursReelTemps.epaisseur * mursReelTemps.hauteur).toFixed(2) }} m¬≥</span>
          </div>
          <div class="info-item">
            <span class="info-label">P√©rim√®tre :</span>
            <span class="info-value">{{ (2 * (mursReelTemps.longueur + mursReelTemps.hauteur)).toFixed(1) }} m</span>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="murs-actions">
        <button (click)="chargerMursActuels()" class="btn-load">
          üì• Charger Propri√©t√©s Actuelles
        </button>
        <button (click)="resetMursReelTemps()" class="btn-reset">
          üîÑ R√©initialiser
        </button>
      </div>
    </div>
  </div>
</div>

<!-- =============================================== -->
<!-- CALCULATEUR DE FEN√äTRES INT√âGR√â -->
<!-- =============================================== -->
<div class="calculateur-overlay" *ngIf="showCalculateurFenetres">
  <div class="calculateur-content">
    <div class="calculateur-header">
      <h2>üßÆ Calculateur de Fen√™tres Intelligent</h2>
      <button (click)="toggleCalculateurFenetres()" class="btn-close">‚úï</button>
    </div>

    <!-- S√©lection du mur -->
    <div class="calculateur-section">
      <h3>üìê S√©lection du Mur</h3>
      <select 
        [(ngModel)]="murSelectionneCalculateur" 
        (change)="onMurSelectionneCalculateur()" 
        class="form-control"
        title="Choisir le mur sur lequel ajouter des fen√™tres"
        aria-label="S√©lection du mur">
        <option value="">-- Choisir un mur --</option>
        <option value="principal">Mur Principal (Fa√ßade) - 8m √ó 2.5m</option>
        <option value="arriere">Mur Arri√®re - 8m √ó 2.5m</option>
        <option value="gauche">Mur Gauche - 5m √ó 2.5m</option>
        <option value="droit">Mur Droit - 5m √ó 2.5m</option>
      </select>
    </div>

    <!-- Param√®tres des fen√™tres -->
    <div class="calculateur-section" *ngIf="murSelectionneCalculateur">
      <h3>ü™ü Param√®tres des Fen√™tres</h3>
      
      <div class="parametres-grid">
        <div class="parametre-item">
          <label>Taille des fen√™tres:</label>
          <select 
            [(ngModel)]="parametresFenetres.tailleFenetre" 
            (change)="onParametresFenetresChange()"
            class="form-control"
            title="Choisir la taille des fen√™tres"
            aria-label="Taille des fen√™tres">
            <option value="petit">Petit (0.8m √ó 1.0m)</option>
            <option value="moyen">Moyen (1.5m √ó 1.2m)</option>
            <option value="grand">Grand (2.5m √ó 1.8m)</option>
          </select>
        </div>

        <div class="parametre-item">
          <label>√âcart entre fen√™tres (m):</label>
          <input 
            type="range" 
            [(ngModel)]="parametresFenetres.ecart" 
            [min]="0.1" 
            [max]="2.0" 
            [step]="0.1"
            (input)="onParametresFenetresChange()"
            class="slider"
            title="Espacement entre les fen√™tres en m√®tres"
            aria-label="√âcart entre fen√™tres">
          <span class="valeur">{{ parametresFenetres.ecart }}m</span>
        </div>

        <div class="parametre-item">
          <label>Nombre de fen√™tres souhait√©es:</label>
          <input 
            type="number" 
            [(ngModel)]="parametresFenetres.nombreFenetres" 
            [min]="0" 
            [max]="20"
            (input)="onParametresFenetresChange()"
            class="number-input"
            title="Nombre de fen√™tres √† ajouter"
            aria-label="Nombre de fen√™tres">
        </div>

        <div class="parametre-item">
          <label>Couleur des fen√™tres:</label>
          <input 
            type="color" 
            [(ngModel)]="parametresFenetres.couleur"
            class="color-input"
            title="Couleur des fen√™tres"
            aria-label="Couleur des fen√™tres">
        </div>
      </div>
    </div>

    <!-- R√©sultats du calcul -->
    <div class="calculateur-section" *ngIf="calculResultat">
      <h3>üìä R√©sultats du Calcul</h3>
      
      <div class="resultats" [class.valid]="calculResultat.isValid" [class.invalid]="!calculResultat.isValid">
        <div class="statut">
          <span class="icone">{{ calculResultat.isValid ? '‚úÖ' : '‚ùå' }}</span>
          <span class="message">{{ calculResultat.message }}</span>
        </div>
        
        <div class="details" *ngIf="calculResultat.isValid">
          <div class="detail-item">
            <strong>Nombre max de fen√™tres:</strong> {{ calculResultat.nombreMaxFenetres }}
          </div>
          <div class="detail-item">
            <strong>Largeur totale utilis√©e:</strong> {{ calculResultat.largeurTotaleUtilisee.toFixed(2) }}m
          </div>
          <div class="detail-item">
            <strong>Marge restante:</strong> {{ calculResultat.margeRestante.toFixed(2) }}m
          </div>
        </div>
      </div>

      <!-- Positions calcul√©es -->
      <div class="positions" *ngIf="calculResultat.positionsCalculees.length > 0">
        <h4>üìç Positions Calcul√©es</h4>
        <div class="position-list">
          <div 
            *ngFor="let position of calculResultat.positionsCalculees; let i = index" 
            class="position-item">
            <span class="numero">Fen√™tre {{ i + 1 }}:</span>
            <span class="coordonnees">
              X: {{ position.x.toFixed(2) }}m, 
              Y: {{ position.y.toFixed(2) }}m, 
              Z: {{ position.z.toFixed(2) }}m
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="calculateur-actions" *ngIf="calculResultat && calculResultat.isValid">
      <button 
        (click)="genererConfigurationFenetres()" 
        class="btn btn-primary"
        [disabled]="parametresFenetres.nombreFenetres > calculResultat.nombreMaxFenetres"
        title="G√©n√©rer le code de configuration">
        üöÄ G√©n√©rer Configuration
      </button>
      
      <button 
        (click)="optimiserDimensionsFenetres()" 
        class="btn btn-secondary"
        title="Optimiser automatiquement les dimensions">
        ‚ö° Optimiser Dimensions
      </button>

      <button 
        (click)="appliquerConfigurationDirecte()" 
        class="btn btn-success"
        [disabled]="!configurationGeneree"
        title="Appliquer directement au mod√®le 3D">
        üéØ Appliquer au Mod√®le
      </button>
    </div>

    <!-- Configuration g√©n√©r√©e -->
    <div class="calculateur-section" *ngIf="configurationGeneree">
      <h3>‚öôÔ∏è Configuration G√©n√©r√©e</h3>
      <div class="config-code">
        <pre>{{ configurationGeneree }}</pre>
      </div>
      <button (click)="copierConfigurationFenetres()" class="btn btn-info">üìã Copier</button>
    </div>
  </div>
</div>
