<div class="scene-container" [class.sidebar-open]="showTestModal">
  <div #canvasContainer class="canvas-container"></div>
  <div class="controls-info">
    <h3>Modélisation</h3>
    
    <div class="controls-section">
      <h4>Contrôles</h4>
      <button class="reset-button" (click)="resetCameraPosition()">Réinitialiser</button>
      <button class="legend-button" (click)="openLegendModal()">Voir la légende</button>
      <button class="test-button" (click)="openTestModal()">🧪 Test des Services</button>
      
      <h4>Contrôles Souris</h4>
      <ul>
        <li><strong>Clic + Glisser</strong> : Rotation autour de la construction</li>
        <li><strong>Molette</strong> : Zoom avant/arrière (5-50)</li>
        <li><strong>Clic droit</strong> : Désactivé</li>
      </ul>
    </div>

    <!-- <div class="specs-section">
      <h4>Couleurs</h4>
      <ul>
        <li>🔘 Murs : Gris</li>
        <li>🟢 Porte : Vert</li>
        <li>🔴 Fenêtres : Rouge</li>
      </ul>
    </div> -->

    <!-- <div class="dimensions-section">
      <h4>Dimensions</h4>
      <ul>
        <li>Hauteur des murs : 2.5m</li>
        <li>Épaisseur : 0.20m</li>
      </ul>
    </div> -->
  </div>

  <!-- Modale de légende -->
  <div class="modal-overlay" [class.show]="showLegendModal" (click)="closeLegendModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Légende de la Modélisation 3D</h2>
        <button class="close-button" (click)="closeLegendModal()">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="legend-section">
          <h3>Architecture du Bâtiment</h3>
          <div class="building-info">
            <div class="info-card">
              <h4>Dimensions Générales</h4>
              <ul>
                <li><strong>Longueur :</strong> 8 m</li>
                <li><strong>Largeur :</strong> 5 m</li>
                <li><strong>Hauteur :</strong> 2.5 m</li>
                <li><strong>Épaisseur des murs :</strong> 0.20 m</li>
              </ul>
            </div>
            
            <div class="info-card">
              <h4>Éléments Structurels</h4>
              <ul>
                <li><strong>Sol :</strong> Plateforme de base (8m × 5m × 0.20m)</li>
                <li><strong>Toit :</strong> Couverture (8.4m × 5m × 0.20m)</li>
                <li><strong>Murs :</strong> 4 murs formant un rectangle</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="legend-section">
          <h3>Ouvertures et Accès</h3>
          <div class="openings-info">
            <div class="opening-card door">
              <div class="opening-icon">🚪</div>
              <div class="opening-details">
                <h4>Porte d'Entrée</h4>
                <ul>
                  <li><strong>Position :</strong> Mur principal </li>
                  <li><strong>Dimensions :</strong> 1m × 2.1m</li>
                  <li><strong>Couleur :</strong> Vert</li>
                  <li><strong>Epaisseur:</strong> 0.05m</li>
                </ul>
              </div>
            </div>

            <div class="opening-card window">
              <div class="opening-icon">🪟</div>
              <div class="opening-details">
                <h4>Fenêtre 1</h4>
                <ul>
                  <li><strong>Position :</strong> Mur principal (façade)</li>
                  <li><strong>Dimensions :</strong> 1.5m × 1.2m</li>
                  <li><strong>Couleur :</strong> Rouge</li>
                  <li><strong>Epaisseur:</strong> 0.05m</li>
                </ul>
              </div>
            </div>

            <div class="opening-card window">
              <div class="opening-icon">🪟</div>
              <div class="opening-details">
                <h4>Fenêtre 2</h4>
                <ul>
                  <li><strong>Position :</strong> Mur principal (façade)</li>
                  <li><strong>Dimensions :</strong> 2m × 1.2m</li>
                  <li><strong>Couleur :</strong> Rouge</li>
                  <li><strong>Epaisseur:</strong> 0.05m</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="legend-section">
          <h3>Code Couleurs</h3>
          <div class="color-legend">
            <div class="color-item">
              <div class="color-box color-walls"></div>
              <span><strong>Murs :</strong> Gris clair (#aaaaaa)</span>
            </div>
            <div class="color-item">
              <div class="color-box color-door"></div>
              <span><strong>Porte :</strong> Vert (#00ff00)</span>
            </div>
            <div class="color-item">
              <div class="color-box color-windows"></div>
              <span><strong>Fenêtres :</strong> Rouge (#ff0000)</span>
            </div>
            <div class="color-item">
              <div class="color-box color-ground"></div>
              <span><strong>Sol :</strong> Marron foncé (#2E1E1A)</span>
            </div>
            <div class="color-item">
              <div class="color-box color-roof"></div>
              <span><strong>Toit :</strong> Bleu royal (#4169e1)</span>
            </div>
          </div>
        </div>

        <div class="legend-section">
          <h3> Contrôles de Navigation</h3>
          <div class="controls-legend">
            <div class="control-item">
              <div class="control-icon">🖱️</div>
              <div class="control-text">
                <strong>Clic + Glisser :</strong> Rotation autour du bâtiment
              </div>
            </div>
            <div class="control-item">
              <div class="control-icon">🎯</div>
              <div class="control-text">
                <strong>Molette :</strong> Zoom avant/arrière (5-50 unités)
              </div>
            </div>
            <div class="control-item">
              <div class="control-icon">🔄</div>
              <div class="control-text">
                <strong>Bouton Réinitialiser :</strong> Retour à la vue initiale
              </div>
            </div>
          </div>
        </div>

        <div class="legend-section">
          <h3>📐 Système de Coordonnées</h3>
          <div class="coordinates-info">
            <div class="axis-info">
              <div class="axis-color axis-x"></div>
              <span><strong>Axe X (Rouge) :</strong> Gauche/Droite</span>
            </div>
            <div class="axis-info">
              <div class="axis-color axis-y"></div>
              <span><strong>Axe Y (Vert) :</strong> Bas/Haut</span>
            </div>
            <div class="axis-info">
              <div class="axis-color axis-z"></div>
              <span><strong>Axe Z (Bleu) :</strong> Avant/Arrière</span>
            </div>
          </div>
        </div>

        <div class="legend-section">
          <h3>💡 Techniques Utilisées</h3>
          <div class="tech-info">
            <div class="tech-card">
              <h4>Three.js</h4>
              <p>Bibliothèque JavaScript pour la création de graphiques 3D dans le navigateur</p>
            </div>
            <div class="tech-card">
              <h4>ExtrudeGeometry</h4>
              <p>Technique utilisée pour créer de vraies ouvertures dans les murs (trous)</p>
            </div>
            <div class="tech-card">
              <h4>Configuration Centralisée</h4>
              <p>Toutes les dimensions et couleurs sont définies dans un fichier de configuration (building-config.ts)</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="close-modal-btn" (click)="closeLegendModal()">Fermer</button>
      </div>
    </div>
  </div>
</div>


<!-- Sidebar de test des services -->
<div class="sidebar-overlay" [class.show]="showTestModal" (click)="closeTestModal($event)">
  <div class="sidebar-content test-sidebar" (click)="$event.stopPropagation()">
    <div class="sidebar-header">
      <h2> Test des Services</h2>
      <button class="sidebar-close" (click)="closeTestModal($event)">×</button>
    </div>
    <div class="sidebar-body">
      <!-- Section des tests de base -->
      <div class="test-section">
        <h3>Tests de Base</h3>
        <div class="test-buttons">
          <button (click)="testStatistiques()" class="btn-test btn-blue">
            <div class="btn-icon"></div>
            <div class="btn-label">Statistiques</div>
          </button>
          <button (click)="testExport()" class="btn-test btn-purple">
            <div class="btn-icon"></div>
            <div class="btn-label">Export</div>
          </button>
          <button (click)="testValidation()" class="btn-test btn-red">
            <div class="btn-icon"></div>
            <div class="btn-label">Synchroniser</div>
          </button>
        </div>
      </div>

      <!-- Section des tests de couleurs automatiques -->
      <div class="test-section">
        <h3> Tests de Couleurs Automatiques</h3>
        <!-- <div class="test-buttons">
          <button (click)="testCouleurs()" class="btn-test btn-orange">
            <div class="btn-icon"></div>
            <div class="btn-label">Couleurs Murs</div>
          </button>
          <button (click)="testCouleursOuvertures()" class="btn-test btn-cyan">
            <div class="btn-icon"></div>
            <div class="btn-label">Couleurs Ouvertures</div>
          </button>
        </div> -->
      </div>

      <!-- Section du sélecteur de couleurs interactif -->
      <div class="test-section">
        <h3> Sélecteur de Couleurs Interactif</h3>
        
        <!-- Sélecteur de couleurs -->
        <div class="color-picker-section">
          <div class="color-picker-container">
            <label for="colorPicker">Choisir une couleur :</label>
            <div class="color-input-group">
              <input type="color" id="colorPicker" [(ngModel)]="selectedColor" (change)="onColorChange()" class="color-picker">
              <span class="color-value">{{selectedColor}}</span>
            </div>
          </div>
        </div>

        <!-- Sélection des éléments -->
        <div class="element-selection-section">
          <div class="element-group">
            <h4> Murs</h4>
            <div class="element-buttons">
              <button (click)="changeElementColor('principal')" class="btn-element" [class.active]="selectedElement === 'principal'">
                <div class="element-icon"></div>
                <div class="element-label">Mur Principal</div>
              </button>
              <button (click)="changeElementColor('arriere')" class="btn-element" [class.active]="selectedElement === 'arriere'">
                <div class="element-icon"></div>
                <div class="element-label">Mur Arrière</div>
              </button>
              <button (click)="changeElementColor('gauche')" class="btn-element" [class.active]="selectedElement === 'gauche'">
                <div class="element-icon"></div>
                <div class="element-label">Mur Gauche</div>
              </button>
              <button (click)="changeElementColor('droit')" class="btn-element" [class.active]="selectedElement === 'droit'">
                <div class="element-icon"></div>
                <div class="element-label">Mur Droit</div>
              </button>
            </div>
          </div>

          <div class="element-group">
            <h4> Ouvertures</h4>
            <div class="element-buttons">
              <button (click)="changeElementColor('fenetre2')" class="btn-element" [class.active]="selectedElement === 'fenetre2'">
                <div class="element-icon"></div>
                <div class="element-label">Fenêtre Principale</div>
    </button>
              <button (click)="changeElementColor('fenetre3')" class="btn-element" [class.active]="selectedElement === 'fenetre3'">
                <div class="element-icon"></div>
                <div class="element-label">Fenêtre Arrière</div>
    </button>
              <button (click)="changeElementColor('porte1')" class="btn-element" [class.active]="selectedElement === 'porte1'">
                <div class="element-icon"></div>
                <div class="element-label">Porte d'Entrée</div>
    </button>
            </div>
          </div>
  </div>
  
        <!-- Actions -->
        <div class="color-actions-section">
          <button (click)="resetAllColors()" class="btn-reset">
            <div class="btn-icon"></div>
            <div class="btn-text">Remettre les couleurs originales</div>
    </button>
        </div>
      </div>

      <!-- Section de communication -->
      <div class="test-section">
        <h3>📡 Communication</h3>
        <div class="test-buttons">
          <button (click)="testCommunication()" class="btn-test btn-gray">
            <div class="btn-icon">📡</div>
            <div class="btn-label">Communication</div>
          </button>
          <button (click)="testMateriaux()" class="btn-test btn-purple">
            <div class="btn-icon">🎨</div>
            <div class="btn-label">Matériaux</div>
          </button>
          <button (click)="testScene()" class="btn-test btn-indigo">
            <div class="btn-icon">🎬</div>
            <div class="btn-label">Scène 3D</div>
          </button>
          <button (click)="testMurs()" class="btn-test btn-brown">
            <div class="btn-icon">🧱</div>
            <div class="btn-label">Murs</div>
          </button>
          <button (click)="testModificationsMurs()" class="btn-test btn-orange">
            <div class="btn-icon">🔧</div>
            <div class="btn-label">Modifications</div>
    </button>
        </div>
  </div>
  
      <!-- Sélecteur de couleurs interactif -->
      <!-- <div class="color-selector-section">
        <h3>🎨 Sélecteur de Couleurs Interactif</h3>
        
        <div class="color-picker-container">
          <label for="colorPicker">Choisissez une couleur :</label>
          <div class="color-input-group">
            <input 
              type="color" 
              id="colorPicker" 
              class="color-picker"
              [(ngModel)]="selectedColor"
              (change)="onColorChange()"
            >
            <span class="color-value">{{ selectedColor }}</span>
          </div>
        </div>

        <div class="element-selector">
          <h4>Choisissez un élément à colorier :</h4>
          <div class="element-buttons">
            <button 
              class="btn-element" 
              [class.active]="selectedElement === 'principal'"
              (click)="changeElementColor('principal')"
            >
              🧱 Mur Principal
            </button>
            <button 
              class="btn-element" 
              [class.active]="selectedElement === 'arriere'"
              (click)="changeElementColor('arriere')"
            >
              🧱 Mur Arrière
            </button>
            <button 
              class="btn-element" 
              [class.active]="selectedElement === 'gauche'"
              (click)="changeElementColor('gauche')"
            >
              🧱 Mur Gauche
            </button>
            <button 
              class="btn-element" 
              [class.active]="selectedElement === 'droit'"
              (click)="changeElementColor('droit')"
            >
              🧱 Mur Droit
            </button>
            <button 
              class="btn-element" 
              [class.active]="selectedElement === 'fenetre2'"
              (click)="changeElementColor('fenetre2')"
            >
              🪟 Fenêtre Principale
            </button>
            <button 
              class="btn-element" 
              [class.active]="selectedElement === 'fenetre3'"
              (click)="changeElementColor('fenetre3')"
            >
              🪟 Fenêtre Arrière
            </button>
            <button 
              class="btn-element" 
              [class.active]="selectedElement === 'porte1'"
              (click)="changeElementColor('porte1')"
            >
              🚪 Porte d'Entrée
            </button>
          </div>
        </div>

        <div class="color-actions">
          <button (click)="resetAllColors()" class="btn-reset">
            🔄 Remettre à zéro
          </button>
        </div>
      </div> -->

      <!-- Modificateur de murs interactif -->
      <div class="mur-modifier-section">
        <h3>🔧 Modificateur de Murs Interactif</h3>
        
        <div class="mur-selector">
          <h4>Choisissez un mur à modifier :</h4>
          <div class="mur-buttons">
            <button 
              class="btn-mur" 
              [class.active]="selectedMur === 'principal'"
              (click)="selectMur('principal')"
            >
              🧱 Mur Principal
            </button>
            <button 
              class="btn-mur" 
              [class.active]="selectedMur === 'arriere'"
              (click)="selectMur('arriere')"
            >
              🧱 Mur Arrière
            </button>
            <button 
              class="btn-mur" 
              [class.active]="selectedMur === 'gauche'"
              (click)="selectMur('gauche')"
            >
              🧱 Mur Gauche
            </button>
            <button 
              class="btn-mur" 
              [class.active]="selectedMur === 'droit'"
              (click)="selectMur('droit')"
            >
              🧱 Mur Droit
            </button>
          </div>
        </div>

        <div class="mur-properties" *ngIf="selectedMur">
          <h4>Propriétés du {{ selectedMur === 'principal' ? 'Mur Principal' : selectedMur === 'arriere' ? 'Mur Arrière' : selectedMur === 'gauche' ? 'Mur Gauche' : 'Mur Droit' }} :</h4>
          
          <!-- Position -->
          <div class="property-group">
            <h5>📍 Position (X, Y, Z) :</h5>
            <div class="input-group">
              <input 
                type="number" 
                [(ngModel)]="murPosition.x" 
                step="0.1" 
                placeholder="X"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="murPosition.y" 
                step="0.1" 
                placeholder="Y"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="murPosition.z" 
                step="0.1" 
                placeholder="Z"
                class="number-input"
              >
              <button (click)="modifierPositionMur()" class="btn-apply">
                ✅ Appliquer Position
              </button>
            </div>
          </div>

          <!-- Dimensions -->
          <div class="property-group">
            <h5>📐 Dimensions (Largeur, Hauteur, Profondeur) :</h5>
            <div class="input-group">
              <input 
                type="number" 
                [(ngModel)]="murDimensions.width" 
                step="0.1" 
                placeholder="Largeur"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="murDimensions.height" 
                step="0.1" 
                placeholder="Hauteur"
                class="number-input"
              >
              <input 
                type="number" 
                [(ngModel)]="murDimensions.depth" 
                step="0.1" 
                placeholder="Profondeur"
                class="number-input"
              >
              <button (click)="modifierDimensionsMur()" class="btn-apply">
                ✅ Appliquer Dimensions
              </button>
            </div>
          </div>

          <!-- Épaisseur -->
          <div class="property-group">
            <h5>📏 Épaisseur :</h5>
            <div class="input-group">
              <input 
                type="number" 
                [(ngModel)]="murEpaisseur" 
                step="0.01" 
                placeholder="Épaisseur"
                class="number-input"
              >
              <button (click)="modifierEpaisseurMur()" class="btn-apply">
                ✅ Appliquer Épaisseur
              </button>
            </div>
          </div>

          <!-- Couleur -->
          <div class="property-group">
            <h5>🎨 Couleur :</h5>
            <div class="input-group">
              <label for="murColorPicker" class="sr-only">Sélecteur de couleur du mur</label>
              <input 
                type="color" 
                id="murColorPicker"
                [(ngModel)]="murCouleur"
                class="color-input"
                title="Sélecteur de couleur du mur"
              >
              <span class="color-display">{{ murCouleur }}</span>
              <button (click)="modifierCouleurMurInteractive()" class="btn-apply">
                ✅ Appliquer Couleur
              </button>
            </div>
          </div>

          <!-- Actions globales -->
          <div class="mur-actions">
            <button (click)="appliquerModificationsMur()" class="btn-apply-all">
              🚀 Appliquer Toutes les Modifications
            </button>
            <button (click)="resetMurValues()" class="btn-reset">
              🔄 Réinitialiser
            </button>
          </div>
        </div>
      </div>

      <!-- Zone de sortie des tests -->
      <div class="test-output-section">
        <h3>📊 Résultats des Tests</h3>
        <div id="services-output" class="test-output">
          <div class="success-message">✅ Services intégrés avec succès!</div>
    <div>Cliquez sur les boutons pour tester les fonctionnalités.</div>
        </div>
      </div>
    </div>
  </div>
</div>
